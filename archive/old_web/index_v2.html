<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Downloader - Download Photos, Videos, Reels, Stories & IGTV</title>
    <meta name="description" content="Download Instagram photos, videos, reels, stories, IGTV and profile pictures in HD quality. Fast, free and easy to use.">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .feature-card {
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
        
        .download-btn {
            transition: all 0.3s ease;
        }
        
        .download-btn:hover {
            transform: scale(1.05);
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        .progress-ring {
            transition: stroke-dashoffset 0.5s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50">
    
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fab fa-instagram text-4xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">Instagram Downloader</h1>
                        <p class="text-sm opacity-90">Download Videos, Photos, Reels, Stories & IGTV</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="#features" class="hover:text-pink-200 transition">Features</a>
                    <a href="#how-to" class="hover:text-pink-200 transition">How To Use</a>
                    <a href="#downloads" class="hover:text-pink-200 transition">My Downloads</a>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Download Section -->
    <main class="container mx-auto px-4 py-12">
        
        <!-- Download Input Card -->
        <div class="max-w-4xl mx-auto mb-12">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">
                    <i class="fas fa-download text-purple-600 mr-2"></i>
                    Download Instagram Content
                </h2>
                
                <!-- Quick Action Buttons -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-6">
                    <button onclick="setDownloadType('auto')" 
                            class="download-type-btn p-3 rounded-lg border-2 border-purple-200 hover:border-purple-500 transition text-center active-type">
                        <i class="fas fa-magic text-purple-600 text-xl mb-1"></i>
                        <div class="text-xs font-semibold">Auto Detect</div>
                    </button>
                    <button onclick="setDownloadType('profile')" 
                            class="download-type-btn p-3 rounded-lg border-2 border-blue-200 hover:border-blue-500 transition text-center">
                        <i class="fas fa-user text-blue-600 text-xl mb-1"></i>
                        <div class="text-xs font-semibold">Profile</div>
                    </button>
                    <button onclick="setDownloadType('profile_pic')" 
                            class="download-type-btn p-3 rounded-lg border-2 border-green-200 hover:border-green-500 transition text-center">
                        <i class="fas fa-image text-green-600 text-xl mb-1"></i>
                        <div class="text-xs font-semibold">Profile Pic</div>
                    </button>
                    <button onclick="setDownloadType('story')" 
                            class="download-type-btn p-3 rounded-lg border-2 border-pink-200 hover:border-pink-500 transition text-center">
                        <i class="fas fa-clock text-pink-600 text-xl mb-1"></i>
                        <div class="text-xs font-semibold">Stories</div>
                    </button>
                    <button onclick="setDownloadType('post')" 
                            class="download-type-btn p-3 rounded-lg border-2 border-red-200 hover:border-red-500 transition text-center">
                        <i class="fas fa-photo-video text-red-600 text-xl mb-1"></i>
                        <div class="text-xs font-semibold">Post/Reel</div>
                    </button>
                </div>
                
                <!-- Input Form -->
                <form id="download-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-link mr-1"></i>
                            Instagram URL or Username
                        </label>
                        <div class="relative">
                            <input type="text" 
                                   id="url-input" 
                                   placeholder="cristiano or https://instagram.com/p/ABC123/" 
                                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition"
                                   required>
                            <i class="fas fa-search absolute right-4 top-4 text-gray-400"></i>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">
                            <i class="fas fa-info-circle mr-1"></i>
                            Paste profile URL, post URL, reel URL, or just username
                        </p>
                    </div>
                    
                    <!-- Options (shown for profile downloads) -->
                    <div id="profile-options" class="space-y-3 hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Max Posts (Optional)</label>
                                <input type="number" 
                                       id="max-posts" 
                                       placeholder="50" 
                                       min="1" 
                                       max="500"
                                       class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 transition">
                            </div>
                            <div class="space-y-2">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="download-profile-pic" checked class="rounded text-purple-600">
                                    <span class="text-sm text-gray-700">Include Profile Picture</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="download-stories" class="rounded text-purple-600">
                                    <span class="text-sm text-gray-700">Include Stories (requires login)</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Download Button -->
                    <button type="submit" 
                            class="download-btn w-full gradient-bg text-white font-bold py-4 rounded-lg shadow-lg hover:shadow-xl transition">
                        <i class="fas fa-download mr-2"></i>
                        Start Download
                    </button>
                </form>
                
                <!-- Loading State -->
                <div id="loading-state" class="hidden text-center py-6">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-200 border-t-purple-600"></div>
                    <p class="mt-3 text-gray-600">Processing your request...</p>
                </div>
                
                <!-- Success State -->
                <div id="success-state" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 text-2xl mr-3 mt-1"></i>
                        <div class="flex-1">
                            <h3 class="font-semibold text-green-800 mb-1">Download Started!</h3>
                            <p class="text-sm text-green-700 mb-3">Your download is in progress. Check "Active Downloads" below.</p>
                            <button onclick="resetForm()" class="text-sm text-green-600 hover:text-green-800 underline">
                                Start Another Download
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Error State -->
                <div id="error-state" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-circle text-red-500 text-2xl mr-3 mt-1"></i>
                        <div class="flex-1">
                            <h3 class="font-semibold text-red-800 mb-1">Error</h3>
                            <p class="text-sm text-red-700" id="error-message"></p>
                        </div>
                        <button onclick="hideError()" class="text-red-400 hover:text-red-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Active Downloads Section -->
        <div id="active-downloads-section" class="max-w-4xl mx-auto mb-12 hidden">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-spinner fa-pulse text-purple-600 mr-2"></i>
                Active Downloads
            </h3>
            <div id="active-downloads-list" class="space-y-4">
                <!-- Dynamic content -->
            </div>
        </div>
        
        <!-- My Downloads Section -->
        <div id="downloads" class="max-w-6xl mx-auto mb-12">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-folder-open text-purple-600 mr-2"></i>
                    My Downloads
                </h3>
                <button onclick="refreshDownloads()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                    <i class="fas fa-sync-alt mr-2"></i>
                    Refresh
                </button>
            </div>
            <div id="downloads-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Dynamic content -->
            </div>
        </div>
        
        <!-- Features Section -->
        <div id="features" class="max-w-6xl mx-auto mb-12">
            <h3 class="text-3xl font-bold text-gray-800 mb-8 text-center">
                <i class="fas fa-star text-yellow-500 mr-2"></i>
                Features
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="feature-card bg-white p-6 rounded-xl shadow-lg">
                    <div class="text-4xl mb-4 text-blue-600">
                        <i class="fas fa-image"></i>
                    </div>
                    <h4 class="text-xl font-bold text-gray-800 mb-2">Profile Pictures</h4>
                    <p class="text-gray-600">Download high-quality profile pictures in original resolution</p>
                </div>
                
                <div class="feature-card bg-white p-6 rounded-xl shadow-lg">
                    <div class="text-4xl mb-4 text-pink-600">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h4 class="text-xl font-bold text-gray-800 mb-2">Stories & Highlights</h4>
                    <p class="text-gray-600">Save stories and highlights before they disappear</p>
                </div>
                
                <div class="feature-card bg-white p-6 rounded-xl shadow-lg">
                    <div class="text-4xl mb-4 text-red-600">
                        <i class="fas fa-video"></i>
                    </div>
                    <h4 class="text-xl font-bold text-gray-800 mb-2">Reels & Videos</h4>
                    <p class="text-gray-600">Download reels, IGTV videos and regular posts</p>
                </div>
                
                <div class="feature-card bg-white p-6 rounded-xl shadow-lg">
                    <div class="text-4xl mb-4 text-green-600">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <h4 class="text-xl font-bold text-gray-800 mb-2">Fast & Easy</h4>
                    <p class="text-gray-600">Just paste the URL and download - no registration needed</p>
                </div>
                
                <div class="feature-card bg-white p-6 rounded-xl shadow-lg">
                    <div class="text-4xl mb-4 text-purple-600">
                        <i class="fas fa-hd-video"></i>
                    </div>
                    <h4 class="text-xl font-bold text-gray-800 mb-2">HD Quality</h4>
                    <p class="text-gray-600">Original quality photos and videos without compression</p>
                </div>
                
                <div class="feature-card bg-white p-6 rounded-xl shadow-lg">
                    <div class="text-4xl mb-4 text-orange-600">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h4 class="text-xl font-bold text-gray-800 mb-2">Safe & Secure</h4>
                    <p class="text-gray-600">No data collection, completely private downloads</p>
                </div>
            </div>
        </div>
        
        <!-- How To Use Section -->
        <div id="how-to" class="max-w-4xl mx-auto mb-12">
            <h3 class="text-3xl font-bold text-gray-800 mb-8 text-center">
                <i class="fas fa-question-circle text-blue-500 mr-2"></i>
                How To Use
            </h3>
            <div class="bg-white rounded-xl shadow-lg p-8">
                <div class="space-y-6">
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 w-10 h-10 gradient-bg text-white rounded-full flex items-center justify-center font-bold">1</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800 mb-1">Open Instagram</h4>
                            <p class="text-gray-600">Go to Instagram app or website and find the content you want to download</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 w-10 h-10 gradient-bg text-white rounded-full flex items-center justify-center font-bold">2</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800 mb-1">Copy Link or Username</h4>
                            <p class="text-gray-600">Tap (•••) and select "Copy Link", or just copy the username</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 w-10 h-10 gradient-bg text-white rounded-full flex items-center justify-center font-bold">3</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800 mb-1">Paste and Download</h4>
                            <p class="text-gray-600">Paste the URL or username here and click "Start Download"</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 w-10 h-10 gradient-bg text-white rounded-full flex items-center justify-center font-bold">4</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800 mb-1">Save to Your Device</h4>
                            <p class="text-gray-600">Download the ZIP file containing all content</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <p class="text-gray-400 mb-2">
                    <i class="fas fa-exclamation-triangle mr-1"></i>
                    For personal use only. Respect Instagram Terms of Service and intellectual property rights.
                </p>
                <p class="text-gray-500 text-sm">
                    © 2025 Instagram Downloader. Made with ❤️ by <a href="https://github.com/Xtra01" class="text-purple-400 hover:text-purple-300">Xtra01</a>
                </p>
                <p class="text-gray-600 text-xs mt-2">
                    Not affiliated with Instagram or Meta
                </p>
            </div>
        </div>
    </footer>
    
    <script>
        let currentDownloadType = 'auto';
        let activeJobs = new Set();
        
        // Set download type
        function setDownloadType(type) {
            currentDownloadType = type;
            
            // Update UI
            document.querySelectorAll('.download-type-btn').forEach(btn => {
                btn.classList.remove('active-type');
            });
            event.target.closest('.download-type-btn').classList.add('active-type');
            
            // Show/hide profile options
            const profileOptions = document.getElementById('profile-options');
            if (type === 'profile') {
                profileOptions.classList.remove('hidden');
            } else {
                profileOptions.classList.add('hidden');
            }
            
            // Update placeholder
            const input = document.getElementById('url-input');
            if (type === 'profile_pic') {
                input.placeholder = 'Enter username (e.g., cristiano)';
            } else if (type === 'story') {
                input.placeholder = 'Enter username (e.g., cristiano)';
            } else if (type === 'post') {
                input.placeholder = 'Paste post or reel URL';
            } else {
                input.placeholder = 'cristiano or https://instagram.com/p/ABC123/';
            }
        }
        
        // Handle form submission
        document.getElementById('download-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const url = document.getElementById('url-input').value.trim();
            const maxPosts = document.getElementById('max-posts').value;
            const downloadProfilePic = document.getElementById('download-profile-pic').checked;
            const downloadStories = document.getElementById('download-stories').checked;
            
            if (!url) {
                showError('Please enter a URL or username');
                return;
            }
            
            // Show loading
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('download-form').classList.add('hidden');
            hideError();
            hideSuccess();
            
            try {
                const response = await fetch('/api/download', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        url: url,
                        type: currentDownloadType,
                        max_posts: maxPosts ? parseInt(maxPosts) : null,
                        download_profile_pic: downloadProfilePic,
                        download_stories: downloadStories
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    // Show success
                    showSuccess(data.message);
                    
                    // Track job
                    activeJobs.add(data.job_id);
                    showActiveDownloads();
                    pollJobStatus(data.job_id);
                } else {
                    showError(data.error || 'Download failed');
                }
                
            } catch (error) {
                showError('Network error: ' + error.message);
            } finally {
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('download-form').classList.remove('hidden');
            }
        });
        
        // Poll job status
        async function pollJobStatus(jobId) {
            const interval = setInterval(async () => {
                try {
                    const response = await fetch(`/api/job/${jobId}`);
                    const job = await response.json();
                    
                    updateActiveDownload(job);
                    
                    if (job.status === 'completed' || job.status === 'failed') {
                        clearInterval(interval);
                        activeJobs.delete(jobId);
                        
                        if (activeJobs.size === 0) {
                            hideActiveDownloads();
                        }
                        
                        if (job.status === 'completed') {
                            refreshDownloads();
                            showToast('Download completed!', 'success');
                        } else {
                            showToast('Download failed: ' + job.error_message, 'error');
                        }
                    }
                } catch (error) {
                    clearInterval(interval);
                    console.error('Poll error:', error);
                }
            }, 1000);
        }
        
        // Update active download UI
        function updateActiveDownload(job) {
            const container = document.getElementById('active-downloads-list');
            let card = document.getElementById(`job-${job.job_id}`);
            
            if (!card) {
                card = document.createElement('div');
                card.id = `job-${job.job_id}`;
                card.className = 'bg-white rounded-lg shadow-lg p-6';
                container.appendChild(card);
            }
            
            const progress = job.progress || 0;
            const statusColor = {
                'running': 'blue',
                'completed': 'green',
                'failed': 'red',
                'pending': 'yellow'
            }[job.status] || 'gray';
            
            card.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-${getIconForType(job.job_type)} text-${statusColor}-600 text-2xl"></i>
                        <div>
                            <h4 class="font-bold text-gray-800">${job.target}</h4>
                            <p class="text-sm text-gray-500">${job.job_type}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-${statusColor}-600">${progress}%</div>
                        <div class="text-xs text-gray-500">${job.phase}</div>
                    </div>
                </div>
                
                <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                    <div class="bg-${statusColor}-600 h-3 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                </div>
                
                <div class="flex justify-between text-sm text-gray-600">
                    <span>Downloaded: ${job.downloaded_items} / ${job.total_items}</span>
                    ${job.failed_items > 0 ? `<span class="text-red-600">Failed: ${job.failed_items}</span>` : ''}
                </div>
            `;
        }
        
        function getIconForType(type) {
            const icons = {
                'profile': 'user',
                'profile_pic': 'image',
                'story': 'clock',
                'post': 'photo-video',
                'reel': 'video',
                'igtv': 'tv'
            };
            return icons[type] || 'download';
        }
        
        function showActiveDownloads() {
            document.getElementById('active-downloads-section').classList.remove('hidden');
        }
        
        function hideActiveDownloads() {
            document.getElementById('active-downloads-section').classList.add('hidden');
        }
        
        // Refresh downloads list
        async function refreshDownloads() {
            try {
                const response = await fetch('/api/profiles/list');
                const profiles = await response.json();
                
                const container = document.getElementById('downloads-list');
                
                if (profiles.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12 text-gray-500">
                            <i class="fas fa-folder-open text-6xl mb-4 opacity-50"></i>
                            <p class="text-lg">No downloads yet</p>
                            <p class="text-sm">Your downloaded content will appear here</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = profiles.map(profile => `
                    <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition">
                        <div class="flex items-center space-x-3 mb-4">
                            <i class="fab fa-instagram text-purple-600 text-3xl"></i>
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-800">${profile.username}</h4>
                                <p class="text-xs text-gray-500">${profile.metadata.download_timestamp ? new Date(profile.metadata.download_timestamp).toLocaleDateString() : ''}</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="text-center p-3 bg-blue-50 rounded-lg">
                                <i class="fas fa-image text-blue-600 mb-1"></i>
                                <div class="text-2xl font-bold text-blue-600">${profile.photo_count}</div>
                                <div class="text-xs text-gray-600">Photos</div>
                            </div>
                            <div class="text-center p-3 bg-red-50 rounded-lg">
                                <i class="fas fa-video text-red-600 mb-1"></i>
                                <div class="text-2xl font-bold text-red-600">${profile.video_count}</div>
                                <div class="text-xs text-gray-600">Videos</div>
                            </div>
                        </div>
                        
                        <button onclick="downloadZip('${profile.username}')" 
                                class="w-full gradient-bg text-white font-semibold py-3 rounded-lg hover:shadow-lg transition">
                            <i class="fas fa-download mr-2"></i>
                            Download ZIP
                        </button>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Refresh error:', error);
            }
        }
        
        // Download ZIP
        async function downloadZip(folder) {
            window.location.href = `/api/download/zip/${folder}`;
            showToast('Preparing download...', 'info');
        }
        
        // UI Helpers
        function showError(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-state').classList.remove('hidden');
        }
        
        function hideError() {
            document.getElementById('error-state').classList.add('hidden');
        }
        
        function showSuccess(message) {
            document.getElementById('success-state').querySelector('p').textContent = message;
            document.getElementById('success-state').classList.remove('hidden');
        }
        
        function hideSuccess() {
            document.getElementById('success-state').classList.add('hidden');
        }
        
        function resetForm() {
            document.getElementById('download-form').reset();
            hideSuccess();
            hideError();
        }
        
        function showToast(message, type) {
            // Simple toast implementation
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            } animate-fade-in`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // Add active-type styling
        const style = document.createElement('style');
        style.textContent = '.active-type { border-color: #9333ea !important; background-color: #f3e8ff; }';
        document.head.appendChild(style);
        
        // Initialize
        refreshDownloads();
        setInterval(refreshDownloads, 30000); // Auto-refresh every 30s
    </script>
</body>
</html>
